---
title: 03. Kubernetes pod ìƒì„± ë° ì¡°ì‘í•˜ê¸°
date: 2019-07-09 11:07:74
category: kubernetes
---

## Kubernetes Pod ìƒì„±í•˜ê¸°
> [Kubernetes pod ìƒì„± ê°€ì´ë“œ (en)](https://kubernetes.io/docs/tasks/configure-pod-container)
---

### âœ”ï¸ yaml ì—†ì´ Pod ìƒì„±í•˜ê¸°

1. `kubectl run --generator=run/v1` ë¥¼ ì‚¬ìš©í•˜ë©´ ë˜ëŠ”ë° ê¶Œì¥í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ë ‡ê²Œ ìƒì„±ëœ __pod__ ì€ default ì„¤ì •ê°’ì„ ê°€ì§„ë‹¤.
```sh
$ kubectl run --generator=run/v1 nodejs --image=seongenie/nodejs --port 8080  
kubectl run --generator=run/v1 is DEPRECATED and will be removed in a future version. Use kubectl create instead.
replicationcontroller/nodejs created
```

2. ìƒì„±ëœ __pod__ ì¡°íšŒí•˜ê¸° `kubectl get pod` ë’¤ì— `-n <namspace>` ë¥¼ ë¶™ì´ë©´ í•´ë‹¹ __namespace__ ë¥¼ ê°€ì§„ __pod__ ì„ ì¡°íšŒí•œë‹¤.
```sh
$ kubectl get pod
NAME           READY   STATUS         RESTARTS   AGE
nodejs-2d4cv   1/1     RUNNING        0          48s
```
---

### âœ”ï¸ yaml íŒŒì¼ì„ ì‘ì„±í•˜ì—¬ Pod ìƒì„±í•˜ê¸°
1. ë¨¼ì € vië¡œ `íŒŒì¼ëª….yaml`ì„ ì—°ë‹¤. (ì˜ˆì œë¡œëŠ” _jenkins_ ì´ë¯¸ì§€ë¥¼ ë„ì›Œë³¸ë‹¤)
```sh
$ vi pod-image.yaml
```
ì•„ë˜ì²˜ëŸ¼ yaml íŒŒì¼ ë‚´ìš©ì„ ì‘ì„±í•œë‹¤.
```yaml
apiVersion: v1
kind: Pod
metadata:
      name: jenkins-test
spec:
      containers:
      - name: jenkins
        image: jenkins
        ports:
        - containerPort: 8080
          protocol: TCP
```
  ì£¼ìš” í•„ë“œë“¤ì´ë‹¤.
    - __name__: ìƒì„±í•  pod ì´ë¦„
    - __image__: ê¸°ë°˜ ë„ì»¤ ì´ë¯¸ì§€ëª… (docker hubì—ì„œ pullí•  ì´ë¯¸ì§€ëª…)
    - __contianerPort__: ì»¨í…Œì´ë„ˆ port ì„¤ì •
2. ì‘ì„±í•œ yaml ì„ ì´ìš©í•˜ì—¬ pod ì„ ìƒì„±í•˜ê³  ì‹œì‘í•œë‹¤. `kubectl create` ëª…ë ¹ì–´ ì‚¬ìš©
```sh
$ kubectl create -f pod-image.yaml
```

3. ìƒì„±ëœ POD ì„ ì¡°íšŒí•˜ì—¬ ì œëŒ€ë¡œ ë„ì›Œì¡ŒëŠ”ì§€ í™•ì¸í•œë‹¤.
```sh
$ kubectl get pod
NAME           READY   STATUS         RESTARTS   AGE
jenkins-test   1/1     RUNNING        0          15s
```

---
### âœ”ï¸ Pod í¬íŠ¸í¬ì›Œë”©
1. `kubectl port-forward <POD_NAME> <external PORT>:<internal PORT>` ëª…ë ¹ì–´ë¥¼ podì— í¬íŠ¸í¬ì›Œë”©ì„ í• ë‹¹í•œë‹¤. ê·¸ í›„, `ctrl + z` ë¥¼ ëˆŒëŸ¬ ëª…ë ¹ì–´ë¥¼ ë¹ ì ¸ë‚˜ì˜¤ê³  `bg` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ì„œ í¬íŠ¸í¬ì›Œë”©ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë™ì‘í•˜ê²Œ í•œë‹¤.
```sh
$ kubectl port-forward jenkins-test 8888:8080
CTRL^Z
$ bg
```
    
2. ì´ì œ curl ëª…ë ¹ì–´ë¥¼ í†µí•´ í¬íŠ¸í¬ì›Œë”©ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
```sh
$ curl localhost:8888
<html>
...
</html>
```

3. (ë¶€ê°€) `kubectl exec <POD_NAME> -- <CMD>` ì„ ì´ìš©í•˜ì—¬ Pod ë‚´ë¶€ì—ì„œ `curl` ëª…ë ¹ì–´ë¥¼ ë‚ ë ¤ í…ŒìŠ¤íŠ¸í•´ë³¼ ìˆ˜ ìˆë‹¤. ë‚´ë¶€ í¬íŠ¸ê°€ 8080 ì´ë¯€ë¡œ 8080 í¬íŠ¸ë¡œ `curl` ëª…ë ¹ì–´ ì‹¤í–‰
```sh
$ kubectl exec jenkins-test -- curl localhost:8080
<html>
...
</html>
```

---

### âœ”ï¸ Labeling í•˜ì—¬ Pod ìƒì„±í•˜ê¸°
pod ìƒì„±ì‹œ ë¼ë²¨ë§í•˜ì—¬ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ë¼ë²¨ì€ í‚¤, ë°¸ë¥˜í˜•íƒœë¡œ ì„¤ì • ê°€ëŠ¥í•˜ë©°, ì´ë ‡ê²Œ í•˜ë©´ ì¶”í›„ pod ê²€ìƒ‰ ë° í•„í„°ë§ì— ìš©ì´í•˜ë‹¤.
(ì˜ˆë¥¼ ë“¤ì–´ app ë¼ë²¨ì˜ ê°’ì´ ui ì¸ê²ƒë§Œ ì¡°íšŒ ê°€ëŠ¥)

1. ë¨¼ì € vië¡œ `íŒŒì¼ëª….yaml`ì„ ì—°ë‹¤. (ì˜ˆì œë¡œëŠ” _jenkins_ ì´ë¯¸ì§€ë¥¼ ë„ì›Œë³¸ë‹¤)
```sh
$ vi pod-jenkins-label.yaml
```
ì•„ë˜ì²˜ëŸ¼ yaml íŒŒì¼ ë‚´ìš©ì„ ì‘ì„±í•œë‹¤.
```yaml
apiVersion: v1
kind: Pod
metadata:
      name: jenkins-test-label
      namespace: jenkins
      labels:
        env: development
        key1: value1
spec:
      containers:
      - name: jenkins
        image: jenkins
        ports:
        - containerPort: 8080
          protocol: TCP
```
2. `kubectl create` ë¥¼ ì‚¬ìš©í•˜ì—¬ pod ì„ ìƒì„±í•œë‹¤. (ê¸°ì¡´ pod ìƒì„±ê³¼ ë™ì¼í•˜ë‹¤. yaml íŒŒì¼ì— __labels__ í•„ë“œë§Œ ì¶”ê°€)
```sh
$ kubectl create -f pod-jenkins-label.yaml
```

3. ìƒì„±ëœ pod ì¡°íšŒ
```sh
$ kubectl get pod --show-labels -n jenkins
```
ìœ„ ëª…ë ¹ì–´ëŠ” _(1)_ `--show-labels` ë¥¼ ì¶”ê°€í•˜ì—¬ pod ì¡°íšŒì‹œ ë¼ë²¨ì´ ê°™ì´ ì¡°íšŒë˜ë„ë¡ í•˜ê³ , _(2)_ `-n jenkins` ë¥¼ ì¶”ê°€í•˜ì—¬ jenkins ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— í•´ë‹¹í•˜ëŠ” pod ì„ ì¡°íšŒí•œë‹¤.


### ğŸ’¡ Labeling ëœ Pod ì¡°íšŒ ëª…ë ¹ì–´ ëª¨ìŒ
- pod ì¡°íšŒ (ë¼ë²¨ë„ ê°™ì´ ì¡°íšŒ)
```sh
$ kubectl get pod --show-labels
```
- ë¼ë²¨ ì¶”ê°€ (--overwrite ë¥¼ ë’¤ì— ì¶”ê°€ì‹œ ê¸°ì¡´ì— ì´ë¯¸ ìˆëŠ” ë¼ë²¨ ë®ì–´ì“°ê¸° ê°€ëŠ¥)
```sh
$ kubectl label pod jenkins-test-label env=production
```
- pod ì¡°íšŒ "env", "key1" ë¼ë²¨ì´ ì»¬ëŸ¼ìœ¼ë¡œ ë³´ì—¬ì§„ë‹¤.
```sh
$ kubectl get pod -L 'env,key1'
```
- "env" ë¼ë²¨ê°’ì´ "production" ì¸ pod ë§Œ ì¡°íšŒí•œë‹¤.
```sh
$ kubectl get pod (--show-labels) -l env=production
```

---

### ğŸ’¡ kubectl ì¡°ì‘ ëª…ë ¹ì–´ ì •ë¦¬ 
##### (ëª¨ë“  ëª…ë ¹ì–´ ë’¤ì— `-n <namespace>` ê°€ëŠ¥)
- `kubectl get node` : ë…¸ë“œ ì¡°íšŒ
- `kubectl get services` : ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ ëª¨ë“  ì„œë¹„ìŠ¤ì˜ ëª©ë¡ ì¡°íšŒ (services ëŒ€ì‹  svcë¡œ ëŒ€ì²´ ê°€ëŠ¥)
- `kubectl get pods -o wide` : ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ ëª¨ë“  pod ì˜ ìƒì„¸ ëª©ë¡ ì¡°íšŒ
- `kubectl get pods -o yaml` : pod ì˜ yaml ì„¤ì • ì¡°íšŒ
- `kubectl describe pod <POD_NAME>` : pod ìƒì„¸ ì¶œë ¥
- `kubectl logs <POD_NAME>` : pod ì˜ ë¡œê·¸ ì¡°íšŒ
- `kubectl exec <POD_NAME> -- <CMD>` : pod ì•ˆì—ì„œ ëª…ë ¹ ì‹¤í–‰
- `kubectl delete pod <POD_NAME>` : pod ì‚­ì œ
- `kubectl delete pod --all` : ì¿ ë²„ë„¤í‹°ìŠ¤ pod ì „ë¶€ ì‚­ì œ
- `kubectl delete all --all` : ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ ì „ë¶€ ì‚­ì œ
- `kubectl apply` : 