---
title: 04. docker 이미지 빌드 및 배포
date: 2019-07-09 12:07:13
category: docker
---

이번 포스팅에서는 Dockerfile 을 작성하여 이미지를 빌드하고 배포하고, 또 실행까지 해본다. 사용할 베이스 이미지는 가장 만만한 __ubuntu__ 다.


---

#### 먼저 Dockerfile에 사용할 수 있는 명령어를 알아보자.
<br/>
<div>
    <table>
        <thead>
            <tr>
                <th>Instruction</th>
                <th style="width:60%">Description</th>
                <th>Example</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>FROM</strong></td>
                <td>Base 될 이미지 이름을 지정, 주로 busybox나 alpine 리눅스 같은 경량 OS를 지정하게 된다. Base 이미지를 지정할때는 ubuntu:16.04 처럼 OS와 버전까지 지정하는 것이 좋다.</td>
                <td><pre>FROM ubuntu:16.04</pre></td>
            </tr>
            <tr>
                <td><strong>RUN</strong></td>
                <td>shell 명령어를 docker 이미지에 실행시킬때 사용한다. 예를 들어 start.sh 의 권한을 755로 변경하고 싶다면 예시처럼 하면 된다.
                <td><pre>RUN chmod 755 start.sh</pre></td>
            </tr>
            <tr>
                <td><strong>ADD</strong></td>
                <td>파일 및 디렉토리를 host에서 docker image 내부 file system로 copy한다. ADD 할려고 하는 디렉토리가 image에 없으면, docker가 자동으로 생성한다. 생성된 디렉토리는 755 mod와 0 UID & GID로 생성된다. 또 ADD 하려는 파일이 tar 압축파일 이면 docker가 자동으로 압축을 풀고 ADD 한다.</td>
                <td><pre>ADD start.sh /bin/start.sh</pre></td>
            </tr>
            <tr>
                <td><strong>COPY</strong></td>
                <td>ADD와 동일하나 URL을 지정할수 없고 압축파일을 자동으로 풀어주지 않는다. (ADD, COPY 할 파일은 빌드할 docker 이미지의 디렉토리에 존재해야한다.)</td>
                <td><pre>COPY start.sh /bin/start.sh</pre></td>
            </tr>
            <tr>
                <td><strong>CMD</strong></td>
                <td>CMD를 사용하여 docker container가 시작할때 실행할 커맨드를 지정할수 있다. RUN instruction 과 기능은 비슷하지만 차이점은 CMD는 docker image를 빌드할때 실행되는 것이 아니라 docker container가 시작될때 실행된다는 것이다. 주로 docker image로 빌드된 application을 실행할때 쓰인다</td>
                <td><pre>RUN ["sh", /bin/start.sh]</pre></td>
            </tr>
        </tbody>
    </table>
</div>
<br/>

#### 이제 위 Instruction 을 가지고 간단한 docker 이미지를 생성하자. 여기서는 ubuntu 이미지로 
```

아래 명령어를 실행하여 디렉토리를 만들고 

```sh
mkdir echo_test
cp start.sh echo_test/.
cd echo_test
```

`vi Dockerfile` 명령어로 Dockerfile 을 작성한다.
```sh
# Dockerfile
FROM node:10

COPY app.js /app.js

CMD ["node", "/app.js"]
```


```sh
$ docker build -t <USERNAME>/<IMAGE_NAME>:<TAG>
```

```sh
$ docker push <IMAGE_NAME>
```

